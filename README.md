# ダーモスコピー画像分類システム

皮膚病変の良性・悪性を判定するAIシステム

## 📋 概要

このプロジェクトは、ダーモスコピー画像を使用して皮膚病変の良性・悪性を自動判定するディープラーニングモデルです。

## 🚀 特徴

- **3段階ファインチューニング**: ImageNet → ISIC → ユーザーデータ → SK良性データ
- **データバランス調整**: 良性・悪性のデータ不均衡を解決
- **感度・特異度計算**: 医療AI評価指標に対応
- **複数モデル比較**: 異なる学習段階のモデルを比較評価

## 🏗️ アーキテクチャ

```
Stage 1: ImageNet事前学習済みEfficientNet-v2
    ↓
Stage 2: ISICデータセット(696枚)で追加学習
    ↓  
Stage 3: ユーザー悪性データ(446枚)でファインチューニング
    ↓
Stage 4: SK良性データ(111枚)でバランス調整
```

## 📁 ファイル構成

```
├── predict_image.py              # 画像判定メインスクリプト
├── isic_pretrain_pipeline.py     # 学習パイプライン
├── dermoscopy_classifier.py      # 分類器定義
├── download_benign_data.py       # 良性データダウンロード
├── advanced_classifier.py       # 階層分類器
├── test.JPG                      # テスト画像
├── AK/                          # 日光角化症画像
├── BCC/                         # 基底細胞癌画像  
├── Bowen病/                      # Bowen病画像
├── MM/                          # 悪性黒色腫画像
└── SK/                          # 脂漏性角化症画像（良性）
```

## 🎯 実行結果

### モデル性能比較（test.JPG判定）

| モデル | 判定 | 確信度 | 良性確率 | 悪性確率 |
|--------|------|--------|----------|----------|
| balanced_finetuned_model | 悪性 | 52.8% | 47.2% | 52.8% |
| finetuned_model | 悪性 | 69.9% | 30.1% | 69.9% |
| isic_pretrained_model | 良性 | 94.5% | 94.5% | 5.5% |

## 🔧 使用方法

### 1. 画像判定
```bash
python3 predict_image.py
```

### 2. 新規学習
```bash
# フル3段階学習
python3 isic_pretrain_pipeline.py

# SK良性データのみ追加学習
python3 isic_pretrain_pipeline.py --sk-only
```

## 📊 データセット

- **ISIC Archive**: 皮膚科データベース（696枚）
- **ユーザー悪性データ**: 臨床画像（446枚）
  - AK（日光角化症）: 30枚
  - BCC（基底細胞癌）: 300枚  
  - Bowen病: 49枚
  - MM（悪性黒色腫）: 67枚
- **SK良性データ**: 脂漏性角化症（111枚）

## ⚕️ 医療AI注意事項

⚠️ **重要**: このシステムは研究・教育目的です。実際の診断は必ず皮膚科専門医が行ってください。

## 🔄 今後の改善予定

- [ ] HAM10000データセットへの移行
- [ ] より多様な良性データの追加
- [ ] アンサンブル学習の実装
- [ ] 説明可能AI（XAI）の統合

## 📈 パフォーマンス改善履歴

1. **初期モデル**: 悪性偏重（test.JPG → 悪性95.4%）
2. **バランス調整後**: 慎重判定（test.JPG → 悪性52.8%）
3. **期待効果**: HAM10000移行で更なる精度向上

## 🛠️ 技術スタック

- **フレームワーク**: PyTorch
- **モデル**: EfficientNet-v2-S
- **データ拡張**: 回転、反転、色調変更
- **評価指標**: 感度、特異度、AUC、F1スコア